## YARN

1. 通过长期运行的守护进程提供自己的核心服务
    - 管理集群上资源使用的资源管理器(Resource Manager);
    - 运行 再集群中所有节点上且能够启动和监控容器的节点管理器(Node Manager).

# HDFS
## Introduction
　　Hadoop分布式文件系统（HDFS）是一种旨在在商品硬件上运行的分布式文件系统。它与现有的分布式文件系统有许多相似之处。但是，与其他分布式文件系统的区别很明显。HDFS具有高度的容错能力，旨在部署在低成本硬件上。HDFS提供对应用程序数据的高吞吐量访问，并且适用于具有大数据集的应用程序。
## HDFS Architecture

![HDFS架构](images/hdfs/hdfsarchitecture.png) 
HDFS具有主从体系结构，HDFS集群由单个管理文件命名空间的NameNode和多个数据节点DataNode组成。在集群内部，一个完整的文件被分为很多个块来存储，这些分块存储在一组DataNode中，NameNode保存了文件块到实际存储节点的映射（元数据），通过这个映射我们可以读取文件。

1. NameNode

    `hadoop/hdfs/name`:

    ```
    .
    ├── current
    │   ├── edits_0000000000000000001-0000000000000000001
    │   ├── edits_0000000000000000002-0000000000000000011
    │   ├── edits_inprogress_0000000000000000074
    │   ├── fsimage_0000000000000000073
    │   ├── fsimage_0000000000000000073.md5
    │   ├── seen_txid
    │   └── VERSION
    └── in_use.lock # 锁文件
    
    ```

    `hadoop/hdfs/name/current/VERSION`:

    ```
    #Sun Nov 24 21:17:07 EST 2019
    namespaceID=364314784  # 首次执行格式化时产生的命名空间ID
    clusterID=CID-f25514a0-1955-4058-a231-66a08b865ab9
    cTime=1574351591335 # NameNode创建的时间
    storageType=NAME_NODE # 当前目录
    blockpoolID=BP-2106182529-192.168.17.130-1574351591335
    layoutVersion=-63  # HDFS布局版本
    ```

2. DataNode:

    `hadoop/hdfs/data`:

    ```
    .
    ├── current
    │   ├── BP-2106182529-192.168.17.130-1574351591335 # 块池
    │   │   ├── current
    │   │   │   ├── dfsUsed
    │   │   │   ├── finalized
    │   │   │   │   └── subdir0
    │   │   │   │       └── subdir0
    │   │   │   │           ├── blk_1073741825 # 原始数据块
    │   │   │   │           ├── blk_1073741825_1001.meta # 对应的元数据文件
    │   │   │   │           ├── blk_1073741832
    │   │   │   │           ├── blk_1073741832_1008.meta
    │   │   │   │           ├── blk_1073741833
    │   │   │   │           └── blk_1073741833_1009.meta
    │   │   │   ├── rbw
    │   │   │   └── VERSION
    │   │   ├── scanner.cursor
    │   │   └── tmp
    │   └── VERSION
    └── in_use.lock # 锁文件
    
    ```

3. 文件冗余
	![块冗余](images/hdfs/hdfsdatanodes.png)
	
	- HDFS将每个文件存储为一系列的块，并且将这些块冗余到不同的DataNode节点上。其中块的大小和冗余份数（复制因子）是可以配置的，文件中除最后一个块外所有的块都有相同的大小（默认128MB）。
	
	- **冗余策略：**在常见情况下，当复制因子为3时，HDFS的放置策略是：如果写入器在数据节点上，则将一个副本放置在本地计算机上；否则，在随机数据节点上，将HDFS放置在不同（远程）机架中的节点上的另一个副本。 最后一个位于同一远程机架中的其他节点上。该策略减少了机架间的写流量，通常可以提高写性能。三分之一的副本位于一个节点上，三分之二的副本位于一个机架上，其余三分之一则平均分布在其余机架上。此策略可提高写入性能，而不会影响数据可靠性或读取性能。
	
如果复制因子大于3，则在确定每个机架的副本数量低于上限（基本上是`（副本-1）/机架+ 2`）以下的同时，随机确定第4个及以下副本的位置。
	
	    由于NameNode不允许DataNode具有同一块的多个副本，因此创建的副本的最大数量是当时DataNode的总数。
	    

	
