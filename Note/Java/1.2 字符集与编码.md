# 字符集与编码

## 概念

- **字符 Character**：文字和符号的总称，包括文字、标点符号、图形符号、数字等
- **字符集 Character Set**：一个系统支持的所有抽象字符的集合。不同地区、不同方式组成的集合有所不同
  - e.g. ASCII, GB2312, GBK, Unicode
- **字符编码 Character Encoding**：字符集中每个字符对应的二进制数转换算法
  - e.g. ASCII, GB2312, GBK, UTF-8, UTF-16

**注意**：ASCII, GB2312, GBK **既指字符集，同时也指代该字符集的字符编码**

## 常见字符集与编码

### ASCII 字符集与编码

#### 定义

- ASCII (American Standard Code for Information Interchange, 美国信息交换标准代码)
- 等同于国际标准ISO/IEC 646

#### 字符集范围

- 128 个字符
  - 33 个控制字符，大部分已被废弃
  - 95 个可现实字符

#### 字符编码格式

- **1** 个字节，最高位为 0,
  - 00000000-01111111
  - 或者 0x00-0x7F
- 常见编码
  - 32：空格
  - 48：数字 0
  - 65：大写字母 A
  - 97：小写字母 a
- 后续其他字符编码都兼容 ASCII

### EASCII 字符集与编码

#### 定义

- EASCII (Extended ASCII，延伸美国标准信息交换码)
- 将 ASCII 码由 7 位扩充为 8 位而成，EASCII 的内码是由 0 到 255 共有 256 个字符组成
- EASCII 码比 ASCII 码扩充出来的符号包括表格符号、计算符号、希腊字母和特殊的拉丁符号

### GB2312 字符集与编码

#### 定义

- GB 2312 或 GB 2312–80 是中华人民共和国国家标准简体中文字符集

#### 字符集范围

- **GB 2312 标准共收录 6763 个汉字**
    - 一级汉字 3755 个
    - 二级汉字 3008 个
    - 拉丁字母、希腊字母、日文平假名及片假名字母、俄语西里尔字母在内的 682个字符
- 不能处理人名、古汉语等方面出现的罕用字和繁体字，需要使用 GBK 及 GB 18030 汉字字符集
- GB 2312 中对所收汉字进行了“分区”处理，每区含有 94 个汉字／符号。这种表示方式也称为区位码
    - 01–09 区为特殊符号
    - 16–55 区为一级汉字，按拼音排序
    - 56–87 区为二级汉字，按部首／笔画排序

#### 字符编码格式

- 2 个字节表示
  - 第一个字节称为“高位字节”
    - 使用了 0xA1–0xF7（把01–87区的区号加上0xA0）
  - 第二个字节称为“低位字节”
    - 使用了 0xA1–0xFE（把01–94加上0xA0）

#### 测试

```java
String str = new String(new byte[]{
	(byte)0xd7, (byte)0xd6, /* 字-对应的gb2312编码 */ 
	(byte)0xb7, (byte)0xfb, /* 符-对应的gb2312编码 */ 
	(byte)0xb1, (byte)0xe0, /* 编-对应的gb2312编码 */ 
	(byte)0xc2, (byte)0xeb, /* 码-对应的gb2312编码 */ }, "gb2312"); 
```

### GBK 字符集与编码

#### 定义

- 汉字内码扩展规范（Chinese Internal Code Extension Specification，简称GBK）

#### 字符集范围

- **GBK 对 GB 2312 进行扩展, 总计拥有 23940 个码位，共收入 21886 个汉字和图形符号**
- GBK 向下完全兼容 GB2312-80 编码
  - 支持GB2312-80编码不支持的部分中文姓，中文繁体，日文假名，还包括希腊字母以及俄语字母等字母。
  - 仍不支持韩国字

#### 字符编码格式

- 2 个字节**表示，总体范围为 8140-FEFE
  - 首字节 81-FE 之间
  - 尾字节 40-FE 之间
  - 排除 XX7F 

#### 测试

```java
String str = new String(new byte[]{
	(byte)0xd7, (byte)0xd6, /* 字-对应的gbk编码 */ 
	(byte)0xb7, (byte)0xfb, /* 符-对应的gbk编码 */ 
	(byte)0xb1, (byte)0xe0, /* 编-对应的gbk编码 */ 
	(byte)0xc2, (byte)0xeb, /* 码-对应的gbk编码 */ }, "gbk"); 
```

### GB18030 字符集与编码

略

### Unicode 字符集

#### 定义

- Unicode（中文：万国码、国际码、统一码、单一码）是计算机科学领域里的一项业界标准
- 它对**世界上大部分的文字系统**进行了整理、编码，使得电脑可以用更为简单的方式来呈现和处理文字。

#### 编码方式

- **一个字符的 Unicode 编码是确定的**。在实际传输过程中，由于不同系统平台的设计不同，以及出于节省空间的目的，对 Unicode 编码的**实现方式**有所不同
  - **实现方式≠编码方式**
- **Unicode 的实现方式称为 Unicode 转换格式**（Unicode Transformation Format，简称**UTF**）
    - UTF-8、UTF-16、UTF-32 是  Unicode 字符集的不同实现方式

### UTF-8 编码

#### 定义

- UTF-8（8-bit Unicode Transformation Format）是实现 Unicode 字符集的可变长度字符编码

#### 编码方式

- 使用 **1-4 个字节** 表示

  - 兼容的 ASCII 字符集只需要 **1** 个字节
    - U+0000-U+007F
  - 带有附加符号的拉丁文、希腊文、西里尔字母、亚美尼亚语、希伯来文、阿拉伯文、叙利亚文及它拿字母则需要 **2** 个字节编码
    - U+0080-U+07FF
  - 其他基本多文种平面（BMP）中的字符（包含了大部分常用字，如**大部分的汉字**）使用 **3** 个字节编码
    - U+0800-U+FFFF

- 每个字节序列有不同规定
  - **单字节字符的最高有效比特永远为 0**
  - 多字节序列中的**首个字符组的最高有效比特决定了序列的长度**
    - 最高有效位为110的是 2 字节序列
    - 最高有效位为1110的是 3 字节序列
    - 如此类推
  - 多字节序列的**非首字节中的首两个最高有效比特为 10**


| 字节长度 | 有效位数 |  字节 1  |  字节 2  |  字节 3  |  字节 4  |
| :------: | :------: | :------: | :------: | :------: | :------: |
| 1 个字节 |  7 bit   | 0xxxxxxx |    -     |    -     |    -     |
| 2 个字节 |  11 bit  | 110xxxxx | 10xxxxxx |    -     |    -     |
| 3 个字节 |  16 bit  | 1110xxxx | 10xxxxxx | 10xxxxxx |    -     |
| 4 个字节 |  21 bit  | 11110xxx | 10xxxxxx | 10xxxxxx | 10xxxxxx |

#### 测试

```java
String str = new String(new byte[]{
	(byte)0xe5, (byte)0xad, (byte)0x97, /* 字-对应的utf-8编码 */ 
	(byte)0xe7, (byte)0xac, (byte)0xa6, /* 符-对应的utf-8编码 */ 
	(byte)0xe7, (byte)0xbc, (byte)0x96, /* 编-对应的utf-8编码 */ 
	(byte)0xe7, (byte)0xa0, (byte)0x81, /* 码-对应的utf-8编码 */ }, "utf-8");

String str = new String(new byte[]{
	(byte)0x5b, (byte)0x57, /* 字-对应的utf-16编码 */ 
	(byte)0x7b, (byte)0x26, /* 符-对应的utf-16编码 */ 
	(byte)0x7f, (byte)0x16, /* 编-对应的utf-16编码 */ 
	(byte)0x78, (byte)0x01, /* 码-对应的utf-16编码 */ }, "utf-16");
```

